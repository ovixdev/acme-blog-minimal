---
// src/pages/blog.astro

import { getCollection } from "astro:content";
import PostCard from "../components/PostCard.astro";
import BaseLayout from "../layouts/BaseLayout.astro";

const allPosts = await getCollection("posts");

const sortedPosts = allPosts.sort((a, b) => {
  return new Date(b.data.pubDate).getTime() - new Date(a.data.pubDate).getTime();
});

const totalPosts: number = sortedPosts.length;
---

<BaseLayout title="Blog" description="Read the latest articles from Acme Ltd">
  <header class="page-header">
    <h1>Blog</h1>
    <p>{totalPosts} {totalPosts === 1 ? "article" : "articles"} published</p>
  </header>

  <div class="posts-list">
    {sortedPosts.map((post) => (
      <PostCard
        title={post.data.title}
        url={`/posts/${post.slug}`}
        pubDate={post.data.pubDate}
        author={post.data.author}
        description={post.data.description}
        tags={post.data.tags}
      />
    ))}
  </div>
</BaseLayout>

<style>
  .page-header {
    margin-bottom: 2rem;
    padding-bottom: 2rem;
    border-bottom: 1px solid #eee;
  }

  .page-header h1 {
    font-size: 2.5rem;
    color: #1a1a2e;
    margin-bottom: 0.5rem;
  }

  .page-header p {
    color: #666;
  }

  .posts-list {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
  }
</style>